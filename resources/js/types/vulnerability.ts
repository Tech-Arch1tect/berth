export type VulnerabilitySeverity =
  | 'Critical'
  | 'High'
  | 'Medium'
  | 'Low'
  | 'Negligible'
  | 'Unknown';

export type ScanStatus = 'pending' | 'running' | 'completed' | 'failed' | 'timeout';

export interface ImageVulnerability {
  id: number;
  scan_id: number;
  image_name: string;
  vulnerability_id: string;
  severity: VulnerabilitySeverity;
  package: string;
  installed_version: string;
  fixed_version?: string;
  description?: string;
  data_source?: string;
  cvss?: number;
  location?: string;
  layer_id?: string;
  raw_match?: string;
  created_at: string;
  updated_at: string;
}

export interface GrypeMatch {
  vulnerability: GrypeVulnerability;
  relatedVulnerabilities?: GrypeVulnerability[];
  matchDetails?: GrypeMatchDetail[];
  artifact: GrypeArtifact;
}

export interface GrypeVulnerability {
  id: string;
  dataSource: string;
  namespace?: string;
  severity: string;
  urls?: string[];
  description?: string;
  cvss?: GrypeCVSS[];
  fix: GrypeFix;
}

export interface GrypeCVSS {
  source?: string;
  type?: string;
  version?: string;
  vector?: string;
  metrics: GrypeCVSSMetrics;
}

export interface GrypeCVSSMetrics {
  baseScore: number;
  exploitabilityScore?: number;
  impactScore?: number;
}

export interface GrypeFix {
  versions?: string[];
  state?: string;
}

export interface GrypeMatchDetail {
  type?: string;
  matcher?: string;
}

export interface GrypeArtifact {
  id?: string;
  name: string;
  version: string;
  type?: string;
  locations?: GrypeLocation[];
  language?: string;
  licenses?: string[];
  cpes?: string[];
  purl?: string;
}

export interface GrypeLocation {
  path?: string;
  layerId?: string;
}

export interface ScanScope {
  id: number;
  scan_id: number;
  image_name: string;
}

export interface ImageScan {
  id: number;
  server_id: number;
  stack_name: string;
  agent_scan_id: string;
  status: ScanStatus;
  total_images: number;
  scanned_images: number;
  started_at: string;
  completed_at?: string;
  error_message?: string;
  last_polled_at?: string;
  poll_failures: number;
  last_poll_error?: string;
  service_filter?: string;
  vulnerabilities?: ImageVulnerability[];
  scopes?: ScanScope[];
  created_at: string;
  updated_at: string;
}

export interface VulnerabilitySummary {
  critical: number;
  high: number;
  medium: number;
  low: number;
  negligible: number;
  unknown: number;
  total: number;
}

export interface LatestScanResponse {
  scan: ImageScan;
  summary: VulnerabilitySummary;
}

export interface ScanWithSummary {
  scan: ImageScan;
  summary?: VulnerabilitySummary;
}

export interface ScansHistoryResponse {
  scans: ScanWithSummary[];
}

export interface ScanComparison {
  base_scan: ImageScan;
  compare_scan: ImageScan;
  new_vulnerabilities: ImageVulnerability[];
  fixed_vulnerabilities: ImageVulnerability[];
  unchanged_count: number;
  same_scope: boolean;
  base_only_images: string[];
  compare_only_images: string[];
  common_images: string[];
}

export interface ScanTrendPoint {
  scan_id: number;
  date: string;
  summary: VulnerabilitySummary;
}

export interface ImageTrendPoint {
  scan_id: number;
  date: string;
  summary: VulnerabilitySummary;
}

export interface PerImageTrend {
  image_name: string;
  trend_points: ImageTrendPoint[];
}

export interface ScanTrendResponse {
  stack_trend: ScanTrendPoint[];
  per_image_trend: PerImageTrend[];
  scope_warning?: string;
}
