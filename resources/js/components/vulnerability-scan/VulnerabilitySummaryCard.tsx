import React from 'react';
import { cn } from '../../utils/cn';
import { theme } from '../../theme';
import { VulnerabilitySummary } from '../../types/vulnerability';
import { ShieldExclamationIcon } from '@heroicons/react/24/outline';

interface VulnerabilitySummaryCardProps {
  summary: VulnerabilitySummary;
  className?: string;
}

const severityConfig = {
  critical: {
    label: 'Critical',
    color: 'text-rose-600 dark:text-rose-400',
    bg: 'bg-rose-100 dark:bg-rose-900/30',
    border: 'border-rose-200 dark:border-rose-800',
  },
  high: {
    label: 'High',
    color: 'text-orange-600 dark:text-orange-400',
    bg: 'bg-orange-100 dark:bg-orange-900/30',
    border: 'border-orange-200 dark:border-orange-800',
  },
  medium: {
    label: 'Medium',
    color: 'text-amber-600 dark:text-amber-400',
    bg: 'bg-amber-100 dark:bg-amber-900/30',
    border: 'border-amber-200 dark:border-amber-800',
  },
  low: {
    label: 'Low',
    color: 'text-blue-600 dark:text-blue-400',
    bg: 'bg-blue-100 dark:bg-blue-900/30',
    border: 'border-blue-200 dark:border-blue-800',
  },
  negligible: {
    label: 'Negligible',
    color: 'text-zinc-500 dark:text-zinc-400',
    bg: 'bg-zinc-100 dark:bg-zinc-800',
    border: 'border-zinc-200 dark:border-zinc-700',
  },
  unknown: {
    label: 'Unknown',
    color: 'text-zinc-500 dark:text-zinc-400',
    bg: 'bg-zinc-100 dark:bg-zinc-800',
    border: 'border-zinc-200 dark:border-zinc-700',
  },
};

export const VulnerabilitySummaryCard: React.FC<VulnerabilitySummaryCardProps> = ({
  summary,
  className,
}) => {
  const hasCritical = summary.critical > 0;
  const hasHigh = summary.high > 0;

  return (
    <div
      className={cn(
        'rounded-lg border p-4',
        'border-zinc-200 dark:border-zinc-800',
        'bg-white dark:bg-zinc-900',
        className
      )}
    >
      <div className="flex items-center gap-3 mb-4">
        <div
          className={cn(
            'w-10 h-10 rounded-lg flex items-center justify-center',
            hasCritical
              ? 'bg-rose-100 dark:bg-rose-900/30 text-rose-600 dark:text-rose-400'
              : hasHigh
                ? 'bg-orange-100 dark:bg-orange-900/30 text-orange-600 dark:text-orange-400'
                : 'bg-emerald-100 dark:bg-emerald-900/30 text-emerald-600 dark:text-emerald-400'
          )}
        >
          <ShieldExclamationIcon className="w-5 h-5" />
        </div>
        <div>
          <p className={cn('text-2xl font-bold tabular-nums', theme.text.strong)}>
            {summary.total}
          </p>
          <p className={cn('text-xs', theme.text.muted)}>
            Total vulnerabilities
            {hasCritical && (
              <span className="ml-1 text-rose-600 dark:text-rose-400">
                Â· {summary.critical} critical
              </span>
            )}
          </p>
        </div>
      </div>

      <div className="grid grid-cols-3 sm:grid-cols-6 gap-2">
        {(['critical', 'high', 'medium', 'low', 'negligible', 'unknown'] as const).map(
          (severity) => {
            const config = severityConfig[severity];
            const count = summary[severity];

            return (
              <div
                key={severity}
                className={cn(
                  'rounded-lg border px-2 py-1.5 text-center',
                  config.bg,
                  config.border
                )}
              >
                <p className={cn('text-lg font-bold tabular-nums', config.color)}>{count}</p>
                <p className={cn('text-xs', theme.text.muted)}>{config.label}</p>
              </div>
            );
          }
        )}
      </div>
    </div>
  );
};
